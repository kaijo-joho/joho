<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>バブルソートの動的なビジュアル表現</title>
  <style>
    .container {
        display: flex;
    }

    .item {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid black;
        background-color: #f0f0f0;
        transition: background-color 0.5s;
    }

    .highlighted {
        background-color: yellow;
    }

    .swapped {
        background-color: red;
    }

    .sorted {
        background-color: green;
    }
    #description{
      line-height: 2rem;
    }
  </style>
</head>

<body>
    <div class="container" id="aryContainer">
        <!-- Items will be added here dynamically -->
    </div>
    <div id="description"></div>
    <button onclick="nextStep()">次へ</button>
  
  
    <label for="arrayLength">配列の長さ:</label>
    <input type="number" id="arrayLength" value="8" min="2" max="20">
    <button onclick="initialize()">配列をリセット</button>

    <script>
      let ary = [];
      let i = 0;
      let j = 0;
      let divs = [];
      const container = document.getElementById('aryContainer');
      const description = document.getElementById('description');
      const arrayLength = document.getElementById('arrayLength');
      let len = parseInt(arrayLength.value);
      initialize();
      

      function initialize(){
        container.innerHTML ='';
        description.textContent = `バブルソートを開始します。`;
        
        len = parseInt(arrayLength.value);
        
        ary = aryShuffle(Array.from({ length: len }, (_, i) => i));
        divs = [];

        for(let x=0;x<ary.length;x++){
          const div = document.createElement('div');
          div.classList.add('item');
          divs.push(div);
          div.textContent = ary[x];
          container.appendChild(div);
        }

        i = 0;
        j = ary.length - 2;
      }

      function nextStep() {
        if(i>=ary.length-1){
          divs[j+1].classList.add('sorted');
          description.textContent = `最後に ${ary[j+1]} が整列済みになり、終了です。`;
          return;
        }
        console.log(i + ',' + j + ': ' + ary);
        
        if(j+2<ary.length){
          divs[j+2].classList.remove('highlighted');
          divs[j+2].classList.remove('swapped');
        }
        divs[j+1].classList.remove('swapped');
        
        if(j<i){
          divs[j+1].classList.remove('highlighted');
          divs[j+2].classList.remove('highlighted');
          divs[j+1].classList.remove('swapped');
          divs[j+2].classList.remove('swapped');
          divs[j+1].classList.add('sorted');
          description.textContent = ` ${ary[j+1]} が整列済みになりました。`;
          i++;
          j = ary.length - 2;
        }else{
          if(divs[j].classList.contains('highlighted') && divs[j+1].classList.contains('highlighted')){
            if(ary[j] > ary[j+1]){
              divs[j].classList.remove('highlighted');
              divs[j+1].classList.remove('highlighted');
              [ary[j], ary[j+1]] = [ary[j+1], ary[j]];
              divs[j].textContent = ary[j];
              divs[j+1].textContent = ary[j+1];

              divs[j].classList.add('swapped');
              divs[j+1].classList.add('swapped');
              description.textContent = ` ${ary[j]} ＞ ${ary[j+1]} なので、交換しました。`;

            }else{
              description.textContent = ` ${ary[j]} ＜ ${ary[j+1]} なので、交換しません。`;
            }

            j--;

          }else{
            divs[j].classList.add('highlighted');
            divs[j+1].classList.add('highlighted');
            description.textContent = ` ${ary[j]} と ${ary[j+1]} を比較します。`;
          } 
        }

      }

      function aryShuffle(ary) {
        for(let i = (ary.length - 1); 0 < i; i--){
          let r = Math.floor(Math.random() * (i + 1));
          [ary[i], ary[r]] = [ary[r], ary[i]];
        }
        return ary;
      }
    </script>
</body>

</html>
